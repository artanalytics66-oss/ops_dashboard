<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ops Finance Monitor v4.0</title>
    <style>
        /* –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò (–í–ú–ï–°–¢–û TAILWIND) */
        :root {
            --primary: #2563eb;
            --bg: #f1f5f9;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text-main); }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* –ö–ê–†–¢–û–ß–ö–ò */
        .card { background: var(--card-bg); border-radius: 12px; box-shadow: var(--shadow); padding: 24px; margin-bottom: 20px; border: 1px solid var(--border); }
        .grid-4 { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .grid-main { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        @media (max-width: 800px) { .grid-main { grid-template-columns: 1fr; } }

        /* –¢–ò–ü–û–ì–†–ê–§–ò–ö–ê */
        h1 { margin: 0 0 5px 0; font-size: 24px; font-weight: 700; color: #0f172a; }
        h3 { margin: 0 0 15px 0; font-size: 16px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .subtitle { color: var(--text-muted); font-size: 14px; margin-bottom: 20px; }
        .value-big { font-size: 28px; font-weight: 700; color: #0f172a; margin-top: 5px; }
        .label-small { font-size: 13px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; }

        /* –¶–í–ï–¢–û–í–´–ï –ê–ö–¶–ï–ù–¢–´ */
        .text-green { color: #16a34a; }
        .text-red { color: #dc2626; }
        .border-l-orange { border-left: 4px solid #f97316; }
        .border-l-yellow { border-left: 4px solid #eab308; }

        /* –¢–ê–ë–õ–ò–¶–ê */
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { text-align: left; padding: 12px; border-bottom: 2px solid var(--border); color: var(--text-muted); }
        td { padding: 12px; border-bottom: 1px solid var(--border); }
        tr:last-child td { border-bottom: none; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; }
        .bg-red { background: #fee2e2; color: #991b1b; }
        .bg-orange { background: #ffedd5; color: #9a3412; }
        .bg-yellow { background: #fef9c3; color: #854d0e; }

        /* –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ */
        .toggle-container { background: #e2e8f0; padding: 4px; border-radius: 8px; display: inline-flex; }
        .toggle-btn { padding: 8px 16px; border: none; background: transparent; cursor: pointer; border-radius: 6px; font-weight: 600; color: #64748b; transition: 0.2s; }
        .toggle-btn.active { background: white; color: var(--primary); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }

        /* –ì–†–ê–§–ò–ö (CSS Bar Chart) */
        .chart-container { display: flex; align-items: flex-end; height: 250px; gap: 15px; padding-top: 30px; }
        .bar-group { flex: 1; display: flex; flex-direction: column; align-items: center; position: relative; }
        .bar { width: 100%; border-radius: 6px 6px 0 0; transition: height 0.5s ease; position: relative; min-height: 4px;}
        .bar-label { font-size: 12px; color: var(--text-muted); margin-top: 8px; text-align: center; }
        .bar-value { position: absolute; top: -25px; font-size: 13px; font-weight: 700; color: #334155; }
        
        /* –¶–≤–µ—Ç–∞ –±–∞—Ä–æ–≤ */
        .fill-blue { background: #3b82f6; }
        .fill-red { background: #ef4444; }
        .fill-orange { background: #f97316; }
        .fill-yellow { background: #eab308; }
        .fill-gray { background: #94a3b8; }
        .fill-green { background: #22c55e; }
    </style>
</head>
<body>

<div class="container">
    
    <!-- –®–ê–ü–ö–ê -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px;">
        <div>
            <h1>–ú–æ–Ω–∏—Ç–æ—Ä –ò—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ó–∞–∫–∞–∑–æ–≤</h1>
            <div class="subtitle">–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ü–∏–∫–ª: –ó–∞–∫–∞–∑ (–í—á–µ—Ä–∞) ‚Üí –î–æ—Å—Ç–∞–≤–∫–∞ (–°–µ–≥–æ–¥–Ω—è)</div>
        </div>
        <div class="toggle-container" id="unitToggle">
            <button class="toggle-btn active" onclick="setUnit('rub')">–†—É–±–ª–∏ ‚ÇΩ</button>
            <button class="toggle-btn" onclick="setUnit('kg')">–í–µ—Å –ö–ì</button>
            <button class="toggle-btn" onclick="setUnit('box')">–ö–æ—Ä–æ–±–∞</button>
        </div>
    </div>

    <!-- –ö–õ–Æ–ß–ï–í–´–ï –¶–ò–§–†–´ (KPI) -->
    <div class="grid-4">
        <div class="card">
            <div class="label-small">–ü–ª–∞–Ω (–°–ø—Ä–æ—Å)</div>
            <div class="value-big" id="kpi-demand">0</div>
        </div>
        <div class="card">
            <div class="label-small">–ü–æ—Ç–µ—Ä–∏ –°–∫–ª–∞–¥–∞</div>
            <div class="value-big text-red" id="kpi-loss-wh">0</div>
        </div>
        <div class="card">
            <div class="label-small">–ü–æ—Ç–µ—Ä–∏ –õ–æ–≥–∏—Å—Ç–∏–∫–∏</div>
            <div class="value-big text-red" id="kpi-loss-log">0</div>
        </div>
        <div class="card">
            <div class="label-small">–§–∞–∫—Ç (–í –∫–∞—Å—Å–µ)</div>
            <div class="value-big text-green" id="kpi-fact">0</div>
        </div>
    </div>

    <div class="grid-main">
        
        <!-- –ì–†–ê–§–ò–ö-–í–û–†–û–ù–ö–ê -->
        <div class="card">
            <h3>–í–æ—Ä–æ–Ω–∫–∞ –ü–æ—Ç–µ—Ä—å (Waterfall)</h3>
            <div class="chart-container" id="chart">
                <!-- –ë–∞—Ä—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è JS -->
            </div>
        </div>

        <!-- –û–ü–ï–†–ê–¶–ò–û–ù–ù–´–ï –ú–ï–¢–†–ò–ö–ò -->
        <div style="display: flex; flex-direction: column; gap: 20px;">
            <div class="card border-l-orange">
                <h3>üì¶ –°–∫–ª–∞–¥ (–ù–æ—á—å)</h3>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>–°–∫–æ—Ä–æ—Å—Ç—å —Å–±–æ—Ä–∫–∏</span>
                    <span style="font-weight: 700;">145 / —á–∞—Å</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å (Cut-off)</span>
                    <span style="font-weight: 700; color: #16a34a;">98.5%</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>–ù–µ—Ç —Ç–æ–≤–∞—Ä–∞ (OOS)</span>
                    <span style="font-weight: 700; color: #dc2626;">2.1%</span>
                </div>
            </div>

            <div class="card border-l-yellow">
                <h3>üöö –õ–æ–≥–∏—Å—Ç–∏–∫–∞ (–£—Ç—Ä–æ)</h3>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>–ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤—Ç–æ</span>
                    <span style="font-weight: 700;">92%</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>–°—Ä–µ–¥–Ω–∏–π –¥—Ä–æ–ø</span>
                    <span style="font-weight: 700;">52 –∫–≥</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>–í–æ–∑–≤—Ä–∞—Ç—ã</span>
                    <span style="font-weight: 700; color: #ca8a04;">3.4%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- –¢–ê–ë–õ–ò–¶–ê –ü–†–û–ë–õ–ï–ú -->
    <div class="card">
        <h3>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å–±–æ–µ–≤ (–¢–æ–ø-5)</h3>
        <table>
            <thead>
                <tr>
                    <th>‚Ññ –ó–∞–∫–∞–∑–∞</th>
                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                    <th>–ü—Ä–æ–±–ª–µ–º–∞</th>
                    <th style="text-align: right;">–ü–æ—Ç–µ—Ä—è</th>
                </tr>
            </thead>
            <tbody id="table-body">
                <!-- –°—Ç—Ä–æ–∫–∏ -->
            </tbody>
        </table>
    </div>

    <div style="text-align: center; color: #94a3b8; font-size: 12px; margin-top: 20px;">
        Ops Finance Flow v4.0 (No-Code/No-VPN Edition)
    </div>

</div>

<script>
    // === –õ–û–ì–ò–ö–ê ===
    
    // 1. –î–∞–Ω–Ω—ã–µ (–ú–æ–¥–µ–ª—å)
    const rawData = Array.from({length: 50}, (_, i) => ({
        id: `ORD-${4000+i}`,
        client: `–ö–ª–∏–µ–Ω—Ç ${['–ê','–ë','–í','–ì','–î'][i%5]}`,
        status: i < 30 ? 'OK' : ['OOS','NotAssembled','NotShipped','Returned'][i%4],
        rub: Math.floor(Math.random()*15000)+3000,
        kg: Math.floor(Math.random()*100)+10,
        box: Math.floor(Math.random()*15)+2
    }));

    let currentUnit = 'rub';

    // 2. –§–æ—Ä–º–∞—Ç—Ç–µ—Ä
    function fmt(val) {
        if (currentUnit === 'rub') return new Intl.NumberFormat('ru-RU', {style:'currency', currency:'RUB', maximumFractionDigits:0}).format(val);
        if (currentUnit === 'kg') return val + ' –∫–≥';
        return val + ' –∫–æ—Ä.';
    }

    // 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
    function render() {
        // –°—á–∏—Ç–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏
        const sum = (filterFn) => rawData.filter(filterFn).reduce((acc, item) => acc + item[currentUnit], 0);
        
        const demand = sum(() => true);
        const lossOOS = sum(x => x.status === 'OOS');
        const lossWhs = sum(x => x.status === 'NotAssembled');
        const lossLog = sum(x => x.status === 'NotShipped');
        const lossRet = sum(x => x.status === 'Returned');
        const fact = sum(x => x.status === 'OK');

        // –û–±–Ω–æ–≤–ª—è–µ–º KPI
        document.getElementById('kpi-demand').innerText = fmt(demand);
        document.getElementById('kpi-loss-wh').innerText = fmt(lossOOS + lossWhs);
        document.getElementById('kpi-loss-log').innerText = fmt(lossLog + lossRet);
        document.getElementById('kpi-fact').innerText = fmt(fact);

        // –û–±–Ω–æ–≤–ª—è–µ–º –ì—Ä–∞—Ñ–∏–∫
        const maxVal = demand; 
        const bars = [
            { label: '–°–ø—Ä–æ—Å', val: demand, color: 'fill-blue' },
            { label: '–ù–µ—Ç —Ç–æ–≤–∞—Ä–∞', val: lossOOS, color: 'fill-red' },
            { label: '–ù–µ —Å–æ–±—Ä–∞–Ω–æ', val: lossWhs, color: 'fill-orange' },
            { label: '–ù–µ –æ—Ç–≥—Ä.', val: lossLog, color: 'fill-yellow' },
            { label: '–í–æ–∑–≤—Ä–∞—Ç', val: lossRet, color: 'fill-gray' },
            { label: '–§–∞–∫—Ç', val: fact, color: 'fill-green' }
        ];

        const chartHtml = bars.map(b => {
            const h = Math.max((b.val / maxVal) * 100, 2); // –º–∏–Ω –≤—ã—Å–æ—Ç–∞ 2%
            return `
                <div class="bar-group">
                    <div class="bar-value">${currentUnit === 'rub' ? (b.val/1000).toFixed(0)+'k' : b.val}</div>
                    <div class="bar ${b.color}" style="height: ${h}%"></div>
                    <div class="bar-label">${b.label}</div>
                </div>
            `;
        }).join('');
        document.getElementById('chart').innerHTML = chartHtml;

        // –û–±–Ω–æ–≤–ª—è–µ–º –¢–∞–±–ª–∏—Ü—É
        const problems = rawData.filter(x => x.status !== 'OK').slice(0, 5);
        const tableHtml = problems.map(row => {
            let badgeClass = 'bg-red', badgeText = row.status;
            if(row.status==='OOS') { badgeClass='bg-red'; badgeText='–ù–µ—Ç —Ç–æ–≤–∞—Ä–∞'; }
            if(row.status==='NotAssembled') { badgeClass='bg-orange'; badgeText='–ù–µ —Å–æ–±—Ä–∞–Ω–æ'; }
            if(row.status==='NotShipped') { badgeClass='bg-yellow'; badgeText='–ù–µ –≤–ª–µ–∑–ª–æ'; }
            if(row.status==='Returned') { badgeClass='bg-gray'; badgeText='–í–æ–∑–≤—Ä–∞—Ç'; } // gray style not defined above, fallback default text color

            return `
                <tr>
                    <td style="font-family: monospace;">${row.id}</td>
                    <td>${row.client}</td>
                    <td><span class="badge ${badgeClass}">${badgeText}</span></td>
                    <td style="text-align: right; font-weight: bold; color: #dc2626;">${fmt(row[currentUnit])}</td>
                </tr>
            `;
        }).join('');
        document.getElementById('table-body').innerHTML = tableHtml || '<tr><td colspan="4" style="text-align:center; padding:20px;">–ù–µ—Ç –ø—Ä–æ–±–ª–µ–º üéâ</td></tr>';
    }

    // 4. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
    function setUnit(u) {
        currentUnit = u;
        document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        render();
    }

    // –°—Ç–∞—Ä—Ç
    render();

    // –•–∞–∫ –¥–ª—è –ø–µ—Ä–≤–æ–π –∫–Ω–æ–ø–∫–∏ (—á—Ç–æ–±—ã –ø–æ–¥—Å–≤–µ—Ç–∏–ª–∞—Å—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–µ–∑ –∫–ª–∏–∫–∞, —Ö–æ—Ç—è –≤ HTML —É–∂–µ active)
    // –ù–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ —Ç—Ä–µ–±—É–µ—Ç event, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–≤–∏–º –∫–∞–∫ –µ—Å—Ç—å.
</script>

</body>
</html>
